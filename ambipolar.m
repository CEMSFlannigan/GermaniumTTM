log_density_100k = [13.0228244636430;13.0933396239475;13.1638667652398;13.2343946112961;13.3049132954206;13.3754369128930;13.4459653227604;13.5165038812292;13.5870284383869;13.6575518209379;13.7280902384539;13.7986082178144;13.8691353591067;13.9396617956350;14.0102023274430;14.0807321468384;14.1512657719593;14.2217873758203;14.2923146043691;14.3628662244637;14.4333954800480;14.5039317832720;14.5744659722041;14.6450043897201;14.7155428072362;14.7860854533361;14.8566393756597;14.9271784979397;14.9977204392756;15.0682616758476;15.1388043219475;15.2093455585194;15.2798966617871;15.3504386031230;15.4209812492229;15.4915246000868;15.5620792271744;15.6326275113862;15.7031729765421;15.7737135083500;15.8442610877978;15.9148037338977;15.9853527228735;16.0558939594454;16.1264239197936;16.1969693849494;16.2675120310494;16.3380680676649;16.4086149423487;16.4791604075046;16.5497065774244;16.6202513378163;16.6907946886802;16.7613408586000;16.8318820951719;16.9024254460358;16.9729772540675;17.0435227192233;17.1140618415033;17.1846009637833;17.2551295146036;17.3256608844797;17.3961866162441;17.4667053003686;17.5372211654371;17.6077370305057;17.6782399749012;17.7487144938161;17.8192056921453;17.8896891380706;17.9601648315921;18.0306285441260;18.1010746375602;18.1715233151291;18.2419520243851;18.3123628796202;18.3827547062278;18.4531380756676;18.5203053251480;18.5842595556306;18.6481982813055;18.7089278563539;18.7600581588948;18.8047729165928;18.8494921042357;18.8941980020436;18.9356964350650;18.9739907257588;19.0225199983778;19.0505560499348;19.0884855469603;19.1215742942625;19.1574770858411;19.1932963237342;19.2201730463701;19.2476690753220;19.2812619022662;19.3086212981772;19.3340937590005;19.3622981115527;19.3822577826514;19.4097141512898;19.4365546960413;19.4644824077551;19.4867256693741;19.5057772017407;19.5280259546457;19.5502669551470;19.5692991065040;19.5931400001128;19.6127610972805;19.6292093139965;19.6540490740729;19.6717347405601;19.6862831568897;19.7089778575950;19.7248123269609;19.7443077767361;19.7628637090018;19.7850976031330;19.8097328043447;19.8268088580971;19.8485607188341;19.8676188407439;19.8916388887131;19.9088608537802;19.9279059258102;19.9494958535980;19.9733816127057;19.9923632873001;20.0134423316768;20.0317589361620;20.0515244649196]; % 1/cm^3
diff_100k = [323.858420987604;324.581068356524;324.295066322731;323.949731971132;324.375717751019;324.386377306260;323.993577100416;322.746391518156;322.677941316321;322.708378310831;321.473059192133;321.958377289826;321.672375256034;321.445705540048;320.032389467930;319.520924626472;318.689065268859;318.869245732119;318.575897792312;316.229086586703;315.765087599490;314.707765434212;313.828440222354;312.593121103655;311.357801984957;309.766488959418;307.225858848975;305.931207412470;304.399226704738;302.926578314813;301.335265289275;299.862616899351;297.559316060133;296.027335352401;294.436022326863;292.785376983519;290.185414555268;288.119442987277;286.290800690512;284.877484618394;282.870845368210;281.279532342672;279.154228456874;277.681580066949;277.158248761930;275.329606465166;273.738293439628;271.019666375764;269.072359443386;267.243717146621;265.355742532050;263.586432553092;261.935787209747;260.047812595176;258.575164205252;256.924518861907;254.561885704883;252.733243408118;251.438591971613;250.143940535108;249.739273865702;249.097277925070;248.929940526891;249.355926306778;250.019241357892;250.682556409005;252.433630619907;256.577774982342;259.317721156687;262.710322826905;266.755579992996;271.809486561800;278.346701075769;284.666363757780;292.667108777646;302.170939181946;313.276742167025;325.094532965783;337.795890774622;351.119753395192;365.748927007507;380.674936931594;394.119104861549;407.924890127624;421.357729396057;435.909406657415;450.615993559219;465.197780603237;481.717329432441;496.319321178893;511.626227159966;528.290454735880;547.934913850739;563.709567771877;579.957529437835;595.472122932286;612.614099804286;630.207332335108;644.732793320184;660.587289729205;676.580394965302;695.433891099749;714.727578413113;732.453241112863;748.963378039314;764.303689343755;780.351528627296;797.052023406710;814.023973450833;830.970233274647;843.339229895140;859.377127759061;875.763600577958;893.645440566921;912.196556421059;929.254526999437;945.557797605881;962.079173787411;980.589456853915;997.888219171212;1015.43209069339;1033.23122049374;1052.55780745533;1067.34336158827;1084.20003769461;1103.63730598690;1119.52149687124;1137.05946929864;1159.22439933752;1180.44586183254;1205.01069382881;1228.24803972827;1237.45348627655]; % cm^2/s

log_density_300k = [13.0372238667409;13.1082303211976;13.1792384206245;13.2502596798129;13.3212891638524;13.3922994565728;13.4633349721696;13.5343463615369;13.6053659757552;13.6763888799138;13.7474101391023;13.8184281083503;13.8894608823301;13.9604920113398;14.0315083356176;14.1025295948061;14.1735541439349;14.2445704682128;14.3155999522522;14.3866606907253;14.4576901747648;14.5286982741916;14.5997178884099;14.6707506623897;14.7417636967272;14.8127882458560;14.8838160849253;14.9548505038753;15.0258898577359;15.0969160518349;15.1679652755167;15.2389680483734;15.3100315284635;15.3810767572177;15.4520963714359;15.5231373702667;15.5941569844850;15.6651930484052;15.7362373371764;15.8072717561264;15.8783061750764;15.9493455289370;16.0203750129764;16.0913847573735;16.1624043715917;16.2334338556312;16.3044748544620;16.3755171692689;16.4465568521235;16.5175896261034;16.5886355598447;16.6596732687351;16.7307043977448;16.8017388166948;16.8727715906746;16.9438109445352;17.0148322037236;17.0858797824352;17.1569142013852;17.2279519102756;17.2989929091064;17.3700289730266;17.4410403623939;17.5120682014631;17.5830872673580;17.6541222346314;17.7251221092073;17.7961400784554;17.8671465329120;17.9381496974283;18.0091512169744;18.0801362868186;18.1511378063647;18.2221064265069;18.2930717567087;18.3640272170893;18.4349695177084;18.5059118183275;18.5768426041552;18.6477520053704;18.7186350870624;18.7894984291121;18.8603634161320;18.9311938587778;19.0019930469899;19.0727905902318;19.1435322044870;19.2142409193383;19.2848838353819;19.3523035968247;19.4164727326646;19.4741861418487;19.5254601095821;19.5735218206422;19.6183273308255;19.6631535206340;19.7079409361451;19.7543459507225;19.7910337386131;19.8390149930061;19.8686392025045;19.9092390585136;19.9450484649583;19.9761943214976;20.0088411813545;20.0371471293631;20.0631596279398;20.0939372579009;20.1193322255275;20.1478810945097;20.1764381060943;20.2018285500529;20.2295835152946;20.2501182539822;20.2774779798850;20.2937057988584;20.3158480552949;20.3411661205649;20.3664974337199;20.3913343099585;20.4139041822722;20.4409148102502;20.4550475366514;20.4739389440215;20.4987887450258;20.5213962930319;20.5435470367313;20.5629312558481;20.5878136918862;20.6126993591157;20.6325223309496;20.6569424983773;20.6767552740070;20.7034927689725;20.7237662630386;20.7408449368980;20.7542188239697;20.7740671730228;20.7993305477047;20.8174046723477;20.8376771388151;20.8540031860086;20.8683155546874;20.8808546454956]; % 1/cm^3
diff_300k = [69.6892552203651;69.7949753986049;69.8855926942391;69.8553869290277;69.7496667507879;69.8201468696144;69.6590494551538;69.7194609855765;69.7043581029708;69.6590494551538;69.6288436899424;69.6288436899424;69.4929177464912;69.3720946856457;69.3871975682514;69.3569918030401;69.2965802726173;69.3116831552230;69.2059629769832;68.8132880292354;68.7075678509956;68.7981851466297;68.7830822640240;68.6471563205728;68.6924649683899;68.6320534379672;68.5414361423331;68.3904073162762;68.1940698424023;68.1185554293739;67.8316006598658;67.9711225277470;67.5532761089896;67.3029997686668;67.2878968860612;67.0764565295816;67.0613536469759;66.8952219383133;66.6535758166224;66.5025469905655;66.3515181645087;66.1551806906347;66.0494605123949;66.1249749254234;66.1098720428177;66.0041518645779;65.7927115080983;65.5691888455342;65.3698307951391;65.2339048516880;64.9771558473913;64.7959212561231;64.6750981952776;64.5240693692207;64.3881434257696;64.1918059518957;64.1616001866843;63.8897482997820;63.7387194737251;63.5574848824569;63.3460445259773;63.1799128173147;63.2403243477375;63.1497070521034;63.1396384636996;62.9835753434409;63.1497070521034;63.1497070521034;63.2554272303432;63.3913531737944;63.5423819998512;63.8444396519649;63.9954684780217;64.4485549561923;64.9318471995742;65.5057567385903;66.2004893384518;66.8952219383133;67.6956747164147;68.6924649683899;69.9309013420561;71.3505723069905;72.7551403893193;74.4768690063674;76.4855523929235;78.5093386620853;81.0466229398405;83.8859648697093;87.3294221038055;90.7275706900848;94.3326287680619;97.9335335533223;101.380766508070;104.682634217738;108.242599403364;111.612699779090;115.338796673378;119.032260553465;123.028321474330;127.068881960015;130.290650453006;134.357910677584;138.185862131350;142.020735739643;146.070196138293;149.751793467761;153.673029194446;157.595583426756;161.541211507492;166.167979593743;170.719988411097;174.707149418998;179.213472016469;183.325231805867;187.226360321782;190.658166760725;194.829852630748;199.481540473299;204.011596172008;208.847215549149;213.326838407729;217.257633300190;220.872074743194;225.252721779575;229.969675650529;234.103388558572;238.197150746198;242.287155192795;246.704478660625;251.092135751909;255.387827075898;259.815368962317;264.204674185631;268.055736112979;272.919498260168;277.007363797641;281.237920943789;285.300617673900;290.454433478361;295.752558258397;300.625755045832;305.037474864759;309.119568277610;312.546628096306]; % cm^2/sec

p1_100 = 21.34;
p2_100 = 113;
p3_100 = 218.2;
p4_100 = 164.1;
p5_100 = -20.31;
p6_100 = 246.6;
log_diff_100k = @(n) p1_100*n.^5 + p2_100*n.^4 + p3_100*n.^3 + p4_100*n.^2 + p5_100*n.^1 + p6_100; % (n-17.27)/2.215

p1_300 = 7.81;
p2_300 = 33.92;
p3_300 = 49.47;
p4_300 = 25.18;
p5_300 = -3.337;
p6_300 = 62.31;
log_diff_300k = @(n) p1_300*n.^5 + p2_300*n.^4 + p3_300*n.^3 + p4_300*n.^2 + p5_300*n.^1 + p6_300; % (n-17.73)/2.478

D_e = @(T,n) ((log_diff_300k(((log(n)/log(10))-17.73)/2.478) - log_diff_100k(((log(n)/log(10))-17.27)/2.215))/(300 - 100)*(T-100) + log_diff_100k(((log(n)/log(10))-17.27)/2.215)); % /(100^2)*(1e9)^2)/1e12

D_e_log = @(T,n) 10^((log(log_diff_300k(((log(n)/log(10))-17.73)/2.478)) - log(log_diff_100k(((log(n)/log(10))-17.27)/2.215)))/(300 - 100)*(T-100) + log(log_diff_100k(((log(n)/log(10))-17.27)/2.215))); % /(100^2)*(1e9)^2)/1e12

plot(log_density_300k, D_e(300,10.^log_density_300k),'b','LineWidth',2);
hold on;
plot(log_density_300k, D_e_log(300,10.^log_density_300k),'r');
plot(log_density_300k, diff_300k, 'k');

plot(log_density_100k, D_e(100,10.^log_density_100k),'b','LineWidth',2);
hold on;
plot(log_density_100k, D_e_log(100,10.^log_density_100k),'r');
plot(log_density_100k, diff_100k, 'k');

Trange = 100:1200;

D_e_res = zeros(length(Trange),length(log_density_100k));
D_e_res_old = zeros(length(Trange),length(log_density_100k));

for i = 1:length(Trange)
    D_e_res(i,:) = D_e_log(Trange(i),10.^log_density_100k);
    D_e_res_old(i,:) = D_e(Trange(i),10.^log_density_100k);
end

D_e_res_old(D_e_res_old < 0) = 0;
D_e_res(D_e_res < 0) = 0;

figure;
surf(log_density_100k,Trange,D_e_res,'edgecolor','none');
hold on;
surf(log_density_100k,Trange,D_e_res_old,'edgecolor','none');
zlim([0 1000]);